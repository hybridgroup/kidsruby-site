webshims.register("forms-picker",function(t,e,a,n,i,s){"use strict";var o=e.picker,r=o._actions,l=s,c=function(t){var e=[t.getFullYear(),l.addZero(t.getMonth()+1),l.addZero(t.getDate())];return e.month=e[0]+"-"+e[1],e.date=e[0]+"-"+e[1]+"-"+e[2],e.time=l.addZero(t.getHours())+":"+l.addZero(t.getMinutes()),e["datetime-local"]=e.date+"T"+e.time,e},d=c(new Date),u=function(e){e=t(e||this.activeButton),this.activeButton.attr({tabindex:"-1","aria-selected":"false"}),this.activeButton=e.attr({tabindex:"0","aria-selected":"true"}),this.index=this.buttons.index(this.activeButton[0]),clearTimeout(this.timer),o._genericSetFocus.apply(this,arguments)},p=function(){var e;this.popover.navedInitFocus&&(e=this.popover.navedInitFocus.sel||this.popover.navedInitFocus,this.activeButton&&this.activeButton[0]||!this.buttons[e]?e&&(this.activeButton=t(e,this.element)):this.activeButton=this.buttons[e](),!this.activeButton[0]&&this.popover.navedInitFocus.alt&&(this.activeButton=this.buttons[this.popover.navedInitFocus.alt]())),this.activeButton&&this.activeButton[0]||(this.activeButton=this.buttons.filter(".checked-value")),this.activeButton[0]||(this.activeButton=this.buttons.filter(".this-value")),this.activeButton[0]||(this.activeButton=this.buttons.eq(0)),this.setFocus(this.activeButton,this.opts.noFocus)},h=e.formcfg,v=h[t.webshims.activeLang()]||h[""];t.webshims.activeLang({register:"form-core",callback:function(){t.each(arguments,function(t,e){return h[e]?(v=h[e],!1):i})}}),e.ListBox=function(e,a,n){this.element=t("ul",e),this.popover=a,this.opts=n||{},this.buttons=t("button:not(:disabled)",this.element),this.ons(this),this._initialFocus()},e.ListBox.prototype={setFocus:u,_initialFocus:p,prev:function(){var t=this.index-1;0>t?this.opts.prev&&(this.popover.navedInitFocus="last",this.popover.actionFn(this.opts.prev),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(t))},next:function(){var t=this.index+1;t>=this.buttons.length?this.opts.next&&(this.popover.navedInitFocus="first",this.popover.actionFn(this.opts.next),this.popover.navedInitFocus=!1):this.setFocus(this.buttons.eq(t))},ons:function(t){this.element.on({keydown:function(e){var a,n=e.keyCode;return e.ctrlKey?i:(36==n||33==n?(t.setFocus(t.buttons.eq(0)),a=!0):34==n||35==n?(t.setFocus(t.buttons.eq(t.buttons.length-1)),a=!0):38==n||37==n?(t.prev(),a=!0):(40==n||39==n)&&(t.next(),a=!0),a?!1:i)}})}},e.Grid=function(e,a,n){this.element=t("tbody",e),this.popover=a,this.opts=n||{},this.buttons=t("button:not(:disabled,.othermonth)",this.element),this.ons(this),this._initialFocus(),this.popover.openedByFocus&&(this.popover.activeElement=this.activeButton)},e.Grid.prototype={setFocus:u,_initialFocus:p,first:function(){this.setFocus(this.buttons.eq(0))},last:function(){this.setFocus(this.buttons.eq(this.buttons.length-1))},upPage:function(){t(".ws-picker-header > button:not(:disabled)",this.popover.element).trigger("click")},downPage:function(){this.activeButton.filter(':not([data-action="changeInput"])').trigger("click")},ons:function(t){this.element.on({keydown:function(e){var a,n=e.keyCode;return e.shiftKey?i:(e.ctrlKey&&40==n?a="downPage":e.ctrlKey&&38==n?a="upPage":33==n||e.ctrlKey&&37==n?a="prevPage":34==n||e.ctrlKey&&39==n?a="nextPage":36==e.keyCode||33==e.keyCode?a="first":35==e.keyCode?a="last":38==e.keyCode?a="up":37==e.keyCode?a="prev":40==e.keyCode?a="down":39==e.keyCode&&(a="next"),a?(t[a](),!1):i)}})}},t.each({prevPage:{get:"last",action:"prev"},nextPage:{get:"first",action:"next"}},function(t,a){e.Grid.prototype[t]=function(){this.opts[a.action]&&(this.popover.navedInitFocus={sel:'button[data-id="'+this.activeButton.attr("data-id")+'"]:not(:disabled,.othermonth)',alt:a.get},this.popover.actionFn(this.opts[a.action]),this.popover.navedInitFocus=!1)}}),t.each({up:{traverse:"prevAll",get:"last",action:"prev",reverse:!0},down:{traverse:"nextAll",get:"first",action:"next"}},function(a,n){e.Grid.prototype[a]=function(){var e=this.activeButton.closest("td").prop("cellIndex"),a="td:nth-child("+(e+1)+") button:not(:disabled,.othermonth)",i=this.activeButton.closest("tr")[n.traverse]();n.reverse&&(i=t(i.get().reverse())),i=i.find(a)[n.get](),i[0]?this.setFocus(i.eq(0)):this.opts[n.action]&&(this.popover.navedInitFocus=a+":"+n.get,this.popover.actionFn(this.opts[n.action]),this.popover.navedInitFocus=!1)}}),t.each({prev:{traverse:"prevAll",get:"last",reverse:!0},next:{traverse:"nextAll",get:"first"}},function(a,n){e.Grid.prototype[a]=function(){var e="button:not(:disabled,.othermonth)",i=this.activeButton.closest("td")[n.traverse]("td");n.reverse&&(i=t(i.get().reverse())),i=i.find(e)[n.get](),i[0]||(i=this.activeButton.closest("tr")[n.traverse]("tr"),n.reverse&&(i=t(i.get().reverse())),i=i.find(e)[n.get]()),i[0]?this.setFocus(i.eq(0)):this.opts[a]&&(this.popover.navedInitFocus=n.get,this.popover.actionFn(this.opts[a]),this.popover.navedInitFocus=!1)}}),o.getWeek=function(t){var e,a=new Date(t.getTime());return a.setDate(a.getDate()+4-(a.getDay()||7)),e=a.getTime(),a.setMonth(0),a.setDate(1),Math.floor(Math.round((e-a)/864e5)/7)+1},o.getYearList=function(t,e){var a,n,i,s,r,l,c,u,p,h,v=e.options,b=v.size,m=v.max.split("-"),g=v.min.split("-"),y=v.cols||4,f=v.value.split("-"),w=0,x=0,k="",D=0;for("max"==e.options.useDecadeBase&&m[0]?w=11-m[0]%12:"min"==e.options.useDecadeBase&&g[0]&&(w=11-g[0]%12),t=1*t[0],h=t-(t+w)%(12*b),a=0;b>a;a++){for(a?h+=12:l=o.isInRange([h-1],m,g)?{"data-action":"setYearList",value:h-1}:!1,k+='<div class="year-list picker-list ws-index-'+a+'"><div class="ws-picker-header"><button disabled="disabled">'+h+" – "+(h+11)+"</button></div>",r=[],n=0;12>n;n++)i=h+n,p=[],o.isInRange([i],m,g)?(s="",x++):s=' disabled=""',i==d[0]&&p.push("this-value"),f[0]==i&&p.push("checked-value"),u=p.length?' class="'+p.join(" ")+'"':"",!n||n%y||(D++,r.push('</tr><tr class="ws-row-'+D+'">')),r.push('<td class="ws-item-'+n+'" role="presentation"><button  data-id="year-'+n+'" type="button"'+s+u+' data-action="setMonthList" value="'+i+'" tabindex="-1" role="gridcell">'+i+"</button></td>");a==b-1&&(c=o.isInRange([i+1],m,g)?{"data-action":"setYearList",value:i+1}:!1),k+='<div class="picker-grid"><table role="grid" aria-label="'+h+" – "+(h+11)+'"><tbody><tr class="ws-row-0">'+r.join("")+"</tr></tbody></table></div></div>"}return{enabled:x,main:k,next:c,prev:l,type:"Grid"}},o.getMonthList=function(t,e){var a,n,i,s,r,l,c,u,p,h,b,m=e.options,g=m.size,y=m.max.split("-"),f=m.min.split("-"),w=m.cols||4,x=m.value.split("-"),k=0,D=0,I="";for(t=t[0]-Math.floor((g-1)/2),a=0;g>a;a++){for(a?t++:u=o.isInRange([t-1],y,f)?{"data-action":"setMonthList",value:t-1}:!1,a==g-1&&(p=o.isInRange([t+1],y,f)?{"data-action":"setMonthList",value:t+1}:!1),l=[],o.isInRange([t,"01"],y,f)||o.isInRange([t,"12"],y,f)?(c=!1,r=""):(r=' disabled=""',c=!0),m.minView>=1&&(r=' disabled=""'),I+='<div class="month-list picker-list ws-index-'+a+'"><div class="ws-picker-header">',I+=m.selectNav?'<select data-action="setMonthList" class="year-select">'+o.createYearSelect(t,y,f).join("")+"</select>":'<button data-action="setYearList"'+r+' value="'+t+'" tabindex="-1">'+t+"</button>",I+="</div>",n=0;12>n;n++)s=v.date.monthkeys[n+1],i=(v.date[m.monthNames]||v.date.monthNames)[n],b=[],c||!o.isInRange([t,s],y,f)?r=' disabled=""':(r="",k++),t==d[0]&&d[1]==s&&b.push("this-value"),x[0]==t&&x[1]==s&&b.push("checked-value"),h=b.length?' class="'+b.join(" ")+'"':"",!n||n%w||(D++,l.push('</tr><tr class="ws-row-'+D+'">')),l.push('<td class="ws-item-'+n+'" role="presentation"><button data-id="month-'+n+'" type="button"'+r+h+' data-action="'+("month"==e.type?"changeInput":"setDayList")+'" value="'+t+"-"+s+'" tabindex="-1" role="gridcell" aria-label="'+v.date.monthNames[n]+'">'+i+"</button></td>");I+='<div class="picker-grid"><table role="grid" aria-label="'+t+'"><tbody><tr class="ws-row-0">'+l.join("")+"</tr></tbody></table></div></div>"}return{enabled:k,main:I,prev:u,next:p,type:"Grid"}},o.getDayList=function(e,a){var n,i,s,r,l,u,p,h,b,m,g,y,f,w,x,k,D,I,F,B,L,T=a.options,M=T.size,E=T.max.split("-"),N=T.min.split("-"),R=T.value.split("-"),j=v.date[T.monthNamesHead]||v.date[T.monthNames]||v.date.monthNames,S=[],P=new Date(e[0],e[1]-1,1),C="datetime-local"==a.type?"setTimeList":"changeInput";for(P.setMonth(P.getMonth()-Math.floor((M-1)/2)),T.yearButtons&&(h=[1*e[0]+1,e[1]],h=o.isInRange(h,E,N)?{"data-action":"setDayList",value:h.join("-")}:!1,b=[1*e[0]-1,e[1]],b=o.isInRange(b,E,N)?{"data-action":"setDayList",value:b.join("-")}:!1),n=0;M>n;n++){for(P.setDate(1),f=P.getMonth(),y=0,n||(B=new Date(P.getTime()),B.setDate(-1),k=c(B),u=o.isInRange(k,E,N)?{"data-action":"setDayList",value:k[0]+"-"+k[1]}:!1),k=c(P),S.push('<div class="day-list picker-list ws-index-'+n+'"><div class="ws-picker-header">'),T.selectNav&&(D=['<select data-action="setDayList" class="month-select" tabindex="0">'+o.createMonthSelect(k,E,N,j).join("")+"</select>",'<select data-action="setDayList" class="year-select" tabindex="0">'+o.createYearSelect(k[0],E,N,"-"+k[1]).join("")+"</select>"],v.date.showMonthAfterYear&&D.reverse(),S.push(D.join(" "))),I=[v.date.monthNames[1*k[1]-1],k[0]],D=[j[1*k[1]-1],k[0]],v.date.showMonthAfterYear&&(D.reverse(),I.reverse()),a.options.selectNav||S.push('<button data-action="setMonthList"'+(T.minView>=2?' disabled="" ':"")+' value="'+k.date+'" tabindex="-1">'+D.join(" ")+"</button>"),S.push('</div><div class="picker-grid"><table role="grid" aria-label="'+I.join(" ")+'"><thead><tr>'),a.options.showWeek&&S.push('<th class="week-header">'+v.date.weekHeader+"</th>"),s=v.date.firstDay;v.date.dayNamesShort.length>s;s++)S.push('<th class="day-'+s+'"><abbr title="'+v.date.dayNames[s]+'">'+v.date.dayNamesShort[s]+"</abbr></th>");for(s=v.date.firstDay;s--;)S.push('<th class="day-'+s+'"><abbr title="'+v.date.dayNames[s]+'">'+v.date.dayNamesShort[s]+"</abbr></th>");for(S.push('</tr></thead><tbody><tr class="ws-row-0">'),a.options.showWeek&&(g=o.getWeek(P),S.push('<td class="week-cell">'+g+"</td>")),i=0;99>i;i++){if(m=i&&!(i%7),w=P.getMonth(),x=f!=w,r=P.getDay(),L=[],m&&x){S.push("</tr>");break}m&&(y++,S.push('</tr><tr class="ws-row-'+y+'">'),a.options.showWeek&&(g++,g>52&&(g=o.getWeek(P)),S.push('<td class="week-cell">'+g+"</td>"))),i||r!=v.date.firstDay&&(l=r-v.date.firstDay,0>l&&(l+=7),P.setDate(P.getDate()-l),r=P.getDay(),w=P.getMonth(),x=f!=w),k=c(P),F='<td role="presentation" class="day-'+r+'"><button data-id="day-'+P.getDate()+'" role="gridcell" data-action="'+C+'" value="'+k.join("-")+'" type="button"',x?L.push("othermonth"):L.push("day-"+P.getDate()),k[0]==d[0]&&d[1]==k[1]&&d[2]==k[2]&&L.push("this-value"),R[0]==k[0]&&k[1]==R[1]&&k[2]==R[2]&&L.push("checked-value"),L.length&&(F+=' class="'+L.join(" ")+'"'),(!o.isInRange(k,E,N)||a.options.disableDays&&-1!=t.inArray(r,a.options.disableDays))&&(F+=' disabled=""'),S.push(F+' tabindex="-1">'+P.getDate()+"</button></td>"),P.setDate(P.getDate()+1)}S.push("</tbody></table></div></div>"),n==M-1&&(k=c(P),k[2]=1,p=o.isInRange(k,E,N)?{"data-action":"setDayList",value:k.date}:!1)}return{enabled:9,main:S.join(""),prev:u,next:p,yearPrev:b,yearNext:h,type:"Grid"}},o.getTimeList=function(e,a){var n,i,s,o,r,c='<div class="time-list picker-list ws-index-0">',d=0,u=0,p=23,h={min:t.prop(a.orig,"min"),max:t.prop(a.orig,"max"),step:t.prop(a.orig,"step")},b=a.options,m=v.date[b.monthNamesHead]||v.date[b.monthNames]||v.date.monthNames,g="";for("time"==a.type?n='<button type="button" disabled="">'+t.trim(t(a.orig).jProp("labels").text()||"").replace(/[\:\*]/g,"")+"</button>":(i=e[2].split("T"),e[2]=i[0],i[1]&&(e[3]=i[1]),n=e[2]+". "+m[1*e[1]-1]+" "+e[0],g=' aria-label="'+n+'"',n='<button tabindex="-1" data-action="setDayList" value="'+e[0]+"-"+e[1]+"-"+e[2]+'" type="button">'+n+"</button>",r=e[0]+"-"+e[1]+"-"+e[2]+"T"),c+='<div class="ws-picker-header">'+n+"</div>",c+='<div class="picker-grid"><table role="grid"'+g+"><tbody><tr>";p>=d;d++)s=l.addZero(""+d)+":00",o=r?r+s:s,!d||d%4||(u++,c+='</tr><tr class="ws-row-'+u+'">'),c+='<td role="presentation"><button role="gridcell" data-action="changeInput" value="'+o+'" type="button" tabindex="-1"',a.isValid(o,h)||(c+=' disabled=""'),e==s&&(c+=' class="checked-value"'),c+=">"+a.formatValue(s)+"</button></td>";return c+="</tr></tbody></table></div></div>",{enabled:9,main:c,prev:!1,next:!1,type:"Grid"}},o.isInRange=function(t,e,a){var n,i=!0;for(n=0;t.length>n;n++){if(a[n]&&a[n]>t[n]){i=!1;break}if(!a[n]||a[n]!=t[n])break}if(i)for(n=0;t.length>n;n++){if(e[n]&&e[n]<t[n]){i=!1;break}if(!e[n]||e[n]!=t[n])break}return i},o.createMonthSelect=function(t,e,a,n){n||(n=v.date.monthNames);for(var i,s=0,r=[],c=t[1]-1;n.length>s;s++)i=c==s?' selected=""':"",(i||o.isInRange([t[0],s+1],e,a))&&r.push('<option value="'+t[0]+"-"+l.addZero(s+1)+'"'+i+">"+n[s]+"</option>");return r},o.createYearSelect=function(t,e,a,n){var i,s=!0,r=!0,l=['<option selected="">'+t+"</option>"],c=0;for(n||(n="");8>c&&(s||r);)c++,i=t-c,s&&o.isInRange([i],e,a)?l.unshift('<option value="'+(i+n)+'">'+i+"</option>"):s=!1,i=t+c,r&&o.isInRange([i],e,a)?l.push('<option value="'+(i+n)+'">'+i+"</option>"):r=!1;return l},function(){var a=function(t){return"get"+t+"List"},n=function(t){return"set"+t+"List"},i={date:"Day",week:"Day",month:"Month","datetime-local":"Time",time:"Time"},s=function(t,e,a){t[a]?e[a+"Element"].attr(t[a]).prop({disabled:!1}):e[a+"Element"].removeAttr("data-action").prop({disabled:!0})};t.each({setYearList:["Year","Month","Day","Time"],setMonthList:["Month","Day","Time"],setDayList:["Day","Time"],setTimeList:["Time"]},function(l,c){var d=c.map(a),u=c.map(n);r[l]=function(a,n,r,l){a=""+a;var p=r.options,h=a.split("-");l||(l=0),t.each(d,function(t,a){if(t>=l){var d=o[a](h,r);if(2>h.length||d.enabled>1||i[r.type]===c[t])return n.element.attr({"data-currentview":u[t]}).addClass("ws-size-"+p.size).data("pickercontent",{data:r,content:d,values:h}),n.bodyElement.html(d.main),s(d,n,"prev"),s(d,n,"next"),p.yearButtons&&(s(d,n,"yearPrev"),s(d,n,"yearNext")),e[d.type]&&new e[d.type](n.bodyElement.children(),n,d),n.element.trigger("pickerchange").filter('[data-vertical="bottom"]').triggerHandler("pospopover"),!1}})}})}(),o.showPickerContent=function(t,e){var a=t.options;t._popoverinit||(o.commonInit(t,e),o.commonDateInit(t,e)),!t._popoverinit||a.restartView?r.setYearList(a.defValue||a.value,e,t,a.startView):r[e.element.attr("data-currentview")||"setYearList"](a.defValue||a.value,e,t,0),t._popoverinit=!0},o.commonDateInit=function(a,i){var s=function(){return t(this).is(".othermonth")&&"pointer"!=t(this).css("cursor")||i.actionFn({"data-action":t.attr(this,"data-action"),value:t(this).val()||t.attr(this,"value")}),!1},l=(new Date).getTime(),c=function(n){var s=[],r="",c="";n.options=a.getOptions()||{},t("div.ws-options",i.contentElement).remove(),t.each(n.options[0],function(t,e){var i=o.isInRange(t.split("-"),n.maxS,n.minS)?"":' disabled="" ';e&&(e=' <span class="ws-label">'+e+"</span>"),s.push('<li role="presentation"><button value="'+t+'" '+i+' data-action="changeInput" tabindex="-1"  role="option"><span class="ws-value">'+a.formatValue(t,!1)+"</span>"+e+"</button></li>")}),s.length&&(l++,n.options[1]&&(c="datalist-"+l,r='<h5 id="'+c+'">'+n.options[1]+"</h5>",c=' aria-labelledbyid="'+c+'" '),new e.ListBox(t('<div class="ws-options">'+r+'<ul role="listbox" '+c+">"+s.join("")+"</div>").insertAfter(i.bodyElement)[0],i,{noFocus:!0}))},u=function(){if(i.isDirty){var n=a.options;n.maxS=n.max.split("-"),n.minS=n.min.split("-"),t("button",i.buttonRow).each(function(){var i;t(this).is(".ws-empty")?(i=v.date.clear,i||(i=h[""].date.clear||"clear",e.warn("could not get clear text from form cfg"))):t(this).is(".ws-current")&&(i=(v[a.type]||{}).currentText,i||(i=(h[""][[a.type]]||{}).currentText||(v.date||{}).currentText||"current",e.warn("could not get currentText from form cfg for "+a.type)),d[a.type]&&"time"!=a.type&&t.prop(this,"disabled",!o.isInRange(d[a.type].split("-"),n.maxS,n.minS))),i&&(t(this).text(i).attr({"aria-label":i}),e.assumeARIA&&t.attr(this,"aria-label",i))}),i.nextElement.attr({"aria-label":v.date.nextText}).find("span").html(v.date.nextText),i.prevElement.attr({"aria-label":v.date.prevText}).find("span").html(v.date.prevText),n.yearButtons&&(i.yearNextElement.attr({"aria-label":v.date.nextText}).find("span").html(v.date.nextText),i.yearPrevElement.attr({"aria-label":v.date.prevText}).find("span").html(v.date.prevText)),c(n,n.maxS,n.minS),i.isVisible&&o.showPickerContent(a,i)}t("button.ws-empty",i.buttonRow).prop("disabled",t.prop(a.orig,"required")),i.isDirty=!1};i.actionFn=function(t){r[t["data-action"]]?r[t["data-action"]](t.value,i,a,0):e.warn("no action for "+t["data-action"])},i.contentElement.html('<button class="ws-prev" tabindex="0"><span></span></button> <button class="ws-next" tabindex="0"><span></span></button><div class="ws-picker-body"></div><div class="ws-button-row"><button type="button" class="ws-current" data-action="changeInput" value="'+d[a.type]+'" tabindex="0"></button> <button type="button" data-action="changeInput" value="" class="ws-empty" tabindex="0"></button></div>'),i.nextElement=t("button.ws-next",i.contentElement),i.prevElement=t("button.ws-prev",i.contentElement),i.bodyElement=t("div.ws-picker-body",i.contentElement),i.buttonRow=t("div.ws-button-row",i.contentElement),i.element.on("updatepickercontent",u),a.options.yearButtons&&(i.element.addClass("ws-year-buttons"),i.yearNextElement=t('<button class="ws-super-next" tabindex="0"><span></span></button>').insertAfter(i.nextElement),i.yearPrevElement=t('<button class="ws-super-prev" tabindex="0"><span></span></button>').insertBefore(i.prevElement)),i.contentElement.on("click","button[data-action]",s).on("change","select[data-action]",s),a.options.inlinePicker&&(a.options.updateOnInput=!0),t(a.options.orig).on("input",function(){var t;a.options.updateOnInput&&i.isVisible&&a.options.value&&(t=i.element.attr("data-currentview"))&&r[t](a.options.value,i,a,0)}),t(n).onTrigger("wslocalechange",a._propertyChange)}});